<!-- templates/accounts/partials/password_change.html -->
{% load static %}
<div class="bg-white shadow rounded p-4">
  <h2 class="text-lg font-semibold mb-4">Change Password</h2>

  {% if messages %}
    <div class="mb-3 space-y-2">
      {% for message in messages %}
        <div class="text-sm px-3 py-2 rounded
          {% if message.tags == 'success' %} bg-green-50 text-green-700 border border-green-200
          {% elif message.tags == 'error' %} bg-red-50 text-red-700 border border-red-200
          {% else %} bg-gray-50 text-gray-700 border border-gray-200 {% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    </div>
  {% endif %}

  <form method="post"
        hx-post="{% url 'accounts:password_change' %}"
        hx-target="#main"
        class="space-y-3">
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div class="text-sm text-red-700 bg-red-50 border border-red-200 rounded px-3 py-2">
        {{ form.non_field_errors }}
      </div>
    {% endif %}

    <div>
      <label class="block text-sm text-gray-600">Current password</label>
      {{ form.old_password }}
      {% for err in form.old_password.errors %}
        <div class="text-xs text-red-600 mt-1">{{ err }}</div>
      {% endfor %}
    </div>

    <div>
      <label class="block text-sm text-gray-600">New password</label>
      {{ form.new_password1 }}
      {% if form.password_validators_help_text_html %}
        <div class="text-xs text-gray-500 mt-1">{{ form.password_validators_help_text_html|safe }}</div>
      {% endif %}
      {% for err in form.new_password1.errors %}
        <div class="text-xs text-red-600 mt-1">{{ err }}</div>
      {% endfor %}
    </div>

    <div>
      <label class="block text-sm text-gray-600">Confirm new password</label>
      {{ form.new_password2 }}
      {% for err in form.new_password2.errors %}
        <div class="text-xs text-red-600 mt-1">{{ err }}</div>
      {% endfor %}
    </div>

    <div class="flex gap-2">
      <button class="px-4 py-2 bg-blue-600 text-white rounded" type="submit">Update Password</button>
      <button class="px-4 py-2 border rounded"
              hx-get="{% url 'dashboard:partial_account' %}" hx-target="#main" type="button">Back</button>
    </div>
  </form>
</div>