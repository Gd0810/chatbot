<!-- templates/dashboard/partials/knowledge.html -->
{% include 'toast.html' %}
<div class="bg-white shadow rounded p-4">
  <h2 class="text-lg font-semibold mb-4">Your Data</h2>

  {% if plan %}
    {# Show AI Knowledge section when plan includes AI #}
    {% if plan.includes_ai %}
      <div class="mb-8">
        <h3 class="text-base font-semibold mb-3">AI Knowledge</h3>

        <form class="mb-6 space-y-2" method="post"
              hx-post="{% url 'dashboard:knowledge_add' %}" hx-target="#main">
          {% csrf_token %}
          <div class="grid grid-cols-1 md:grid-cols-5 gap-2">
            <div class="md:col-span-2">
              <label class="block text-sm text-gray-600">Bot</label>
              <select name="bot_id" class="border rounded px-2 py-1 w-full">
                {% for b in bots %}<option value="{{ b.id }}">{{ b.name }}</option>{% endfor %}
              </select>
            </div>
            <div class="md:col-span-2">
              <label class="block text-sm text-gray-600">Title (optional)</label>
              <input name="title" class="border rounded px-2 py-1 w-full" placeholder="Knowledge title"/>
            </div>
            <div>
              <label class="block text-sm text-gray-600">Source Type</label>
              <select name="source_type" class="border rounded px-2 py-1 w-full">
                <option value="TEXT">Text</option>
                <option value="JSON">JSON</option>
              </select>
            </div>
          </div>

          <div class="mt-2">
            <label class="block text-sm text-gray-600">Content</label>
            <textarea name="content" class="border rounded px-2 py-1 w-full" rows="4"
                      placeholder="Enter text or JSON"></textarea>
          </div>

          <button class="mt-2 px-4 py-2 bg-blue-600 text-white rounded" type="submit">Add</button>
        </form>

        <div class="space-y-2">
          {% for s in sources %}
            <div class="border rounded p-3">
              <div class="text-sm text-gray-500 mb-1">
                <span class="font-medium">{{ s.title|default:"(Untitled)" }}</span> •
                {{ s.bot.name }} • {{ s.get_source_type_display }} • {{ s.created_at }}
              </div>

              <div class="flex gap-2">
                <button class="px-3 py-1 border rounded"
                        hx-get="{% url 'dashboard:knowledge_edit_form' s.id %}"
                        hx-target="#main">Edit</button>

                <button class="px-3 py-1 border rounded"
                        hx-get="{% url 'dashboard:chunks_list' s.id %}"
                        hx-target="#main">Manage Chunks</button>

                <form method="post" hx-post="{% url 'dashboard:knowledge_delete' s.id %}" hx-target="#main">
                  {% csrf_token %}
                  <button class="px-3 py-1 border rounded text-red-600">Delete</button>
                </form>
              </div>
            </div>
          {% empty %}
            <div class="text-gray-500">No knowledge added yet.</div>
          {% endfor %}
        </div>
      </div>
    {% endif %}

    {# Show Q&A placeholder when plan includes Q&A (QA_ONLY, LIVE_QA, FULL) #}
    {% if plan.includes_qa %}
      <div class="border rounded p-4 bg-gray-50">
        <h3 class="text-base font-semibold mb-2">Q&A Manager (Placeholder)</h3>
        <p class="text-sm text-gray-600">
          Your plan includes Q&amp;A. This section will let you create question/answer pairs for your bot.
          UI coming soon. For now, you can proceed with AI Knowledge above if your plan also includes AI.
        </p>
      </div>
    {% endif %}

    {# If neither AI nor Q&A included #}
    {% if not plan.includes_ai and not plan.includes_qa %}
      <div class="text-gray-600">Your plan does not include AI or Q&A features.</div>
    {% endif %}
  {% else %}
    <div class="text-gray-600">No active plan.</div>
  {% endif %}
</div>