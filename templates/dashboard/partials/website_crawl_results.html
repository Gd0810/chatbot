<div class="border-t pt-6" id="crawl-results-area">
  <h3 class="text-lg font-semibold mb-4">Results ({{ total }} pages found)</h3>
  
  {% if pages %}
      <!-- Page Selector -->
      <div class="mb-4">
        <label for="page-selector" class="block text-sm font-medium text-gray-700 mb-2">Select Page:</label>
        <select id="page-selector" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-indigo-500 focus:border-indigo-500"
                onchange="showPage(this.value)">
            {% for page in pages %}
                <option value="{{ forloop.counter0 }}">{{ page.title }} ({{ page.path }})</option>
            {% endfor %}
        </select>
      </div>

      <!-- Page Content -->
      <div id="page-content" class="space-y-6">
        {% for page in pages %}
            <div id="page-{{ forloop.counter0 }}" class="page-section {% if not forloop.first %}hidden{% endif %}">
                <div class="bg-gray-50 p-4 rounded-md mb-4">
                    <h4 class="font-semibold text-lg">{{ page.title }}</h4>
                    <p class="text-sm text-gray-600 mt-1">URL: <a href="{{ page.url }}" target="_blank" class="text-indigo-600 hover:underline">{{ page.url }}</a></p>
                    <p class="text-sm text-gray-600">Path: {{ page.path }}</p>
                </div>

                {% for section in page.sections %}
                <div class="border border-gray-200 rounded-md p-4 mb-4">
                    <h5 class="font-semibold text-md mb-2">{{ section.heading }}</h5>
                    <pre class="text-sm text-gray-700 whitespace-pre-wrap font-sans mb-3">{{ section.content|default:"(No content)" }}</pre>
                    <button class="px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 text-sm"
                            onclick="copyToClipboard(this)">
                        <span class="hidden data-heading">{{ section.heading }}</span>
                        <span class="hidden data-content">{{ section.content }}</span>
                        <iconify-icon icon="mdi:content-copy" class="mr-1"></iconify-icon> Copy
                    </button>
                </div>
                {% endfor %}
            </div>
        {% endfor %}
      </div>
  {% else %}
      <p class="text-gray-500 italic">No content found.</p>
  {% endif %}
</div>

<script>
function showPage(index) {
    // Hide all pages
    document.querySelectorAll('.page-section').forEach(el => el.classList.add('hidden'));
    // Show selected
    document.getElementById('page-' + index).classList.remove('hidden');
}

function copyToClipboard(btn) {
    const heading = btn.querySelector('.data-heading').textContent;
    const content = btn.querySelector('.data-content').textContent;
    const text = `# ${heading}\n\n${content}`;

    navigator.clipboard.writeText(text).then(() => {
        const originalHTML = btn.innerHTML;
        // Temporarily change button content
        btn.innerHTML = '<iconify-icon icon="mdi:check" class="mr-1"></iconify-icon> Copied!';
        btn.classList.add('bg-green-200');
        btn.classList.remove('bg-gray-200');
        
        setTimeout(() => {
            btn.innerHTML = originalHTML;
            btn.classList.remove('bg-green-200');
            btn.classList.add('bg-gray-200');
        }, 2000);
    }).catch(err => {
        alert('Failed to copy: ' + err);
    });
}
</script>
