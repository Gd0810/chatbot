<!-- templates/dashboard/partials/bot_edit.html (updated to use dropdown for providers) -->
{% include 'toast.html' %}
<div class="bg-white shadow rounded p-4">
  <h2 class="text-lg font-semibold mb-4">Edit Bot</h2>
  <form method="post"
        hx-post="{% url 'dashboard:bot_edit' bot.id %}"
        hx-target="#main"
        class="space-y-3">
    {% csrf_token %}

    
  {% if available_bot_modes|length > 1 %}
    <div>
      <label class="block text-sm text-gray-600">Default Bot Mode</label>
      <select name="default_bot_mode" class="border rounded px-2 py-1 w-full">
        <option value="">-- Auto ({{ plan.get_bundle_display }} default) --</option>
        {% for mode in available_bot_modes %}
          <option value="{{ mode }}" {% if bot.workspace.default_bot_mode == mode %}selected{% endif %}>
            {% if mode == 'AI' %}AI Bot
            {% elif mode == 'LIVE' %}Live Chat
            {% elif mode == 'QA' %}Q&A Bot
            {% endif %}
          </option>
        {% endfor %}
      </select>
      <p class="text-xs text-gray-500 mt-1">Choose which bot to display by default. Users can switch between available bots.</p>
    </div>
    {% endif %}
    <div>
      <label class="block text-sm text-gray-600">Name</label>
      <input name="name" value="{{ bot.name }}" class="border rounded px-2 py-1 w-full"/>
    </div>

    {% if plan and plan.includes_ai %}
      <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
        <div>
          <label class="block text-sm text-gray-600">AI Provider</label>
          <select name="ai_provider" class="border rounded px-2 py-1 w-full">
            {% for value,label in ai_providers %}
              <option value="{{ value }}" {% if bot.ai_provider == value %}selected{% endif %}>
                {{ label }}
              </option>
            {% endfor %}
          </select>
        </div>
        <div>
          <label class="block text-sm text-gray-600">AI Model</label>
          <input name="ai_model"
                 value="{{ bot.ai_model|default_if_none:'' }}"
                 class="border rounded px-2 py-1 w-full"
                 placeholder="e.g., openai/gpt-4o-mini"/>
        </div>
      </div>

      <div>
        <label class="block text-sm text-gray-600">API Key</label>
        <input name="ai_api_key"
               type="password"
               value=""
               class="border rounded px-2 py-1 w-full"
               placeholder="•••••• (leave blank to keep)"/>
      </div>
      <p class="text-xs text-gray-500">
        Supports Google, OpenAI, OpenRouter, Anthropic, Cohere, Hugging Face, Replicate, etc.
      </p>
    {% else %}
      <div class="text-sm text-gray-600">
        AI fields hidden (your plan does not include AI).
      </div>
    {% endif %}

    <div class="flex gap-2">
      <button class="px-4 py-2 bg-blue-600 text-white rounded" type="submit">Save</button>
      <button class="px-4 py-2 border rounded"
              hx-get="{% url 'dashboard:partial_bots' %}"
              hx-target="#main"
              type="button">Back</button>
    </div>
  </form>
  <div class="mt-8 p-4 bg-gray-50 rounded border border-gray-200">
    <h3 class="text-md font-semibold mb-2">Embed This Bot</h3>
    <p class="text-sm text-gray-600 mb-2">Copy and paste this code into your website to embed the chatbot:</p>
      <pre id="embed-script-block" class="bg-white border rounded p-3 text-xs overflow-x-auto select-all"><code>&lt;script src="http://{{ request.get_host }}/static/embed/bot.js"&gt;&lt;/script&gt;
        &lt;script&gt;
          RedbotLoad('{{ bot.public_key }}');
          RedbotLoad(document.getElementById('redbot-chat').getAttribute('data-public-key'));
        &lt;/script&gt;</code></pre>
      <button class="px-3 py-1 bg-gray-200 text-gray-700 mt-2 rounded hover:bg-gray-300 text-sm"
                            onclick="copyEmbedScript(this)">
                        <iconify-icon icon="mdi:content-copy" class="mr-1"></iconify-icon> Copy
      </button>
      <script>
        function copyEmbedScript(btn) {
          const block = document.getElementById('embed-script-block');
          if (!block) return;
          const code = block.innerText || block.textContent;
          
          navigator.clipboard.writeText(code).then(function() {
            const originalHTML = btn.innerHTML;
            const originalClasses = Array.from(btn.classList);
            
            btn.innerHTML = '<iconify-icon icon="mdi:check"></iconify-icon> Copied!';
            btn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
            btn.classList.add('bg-green-600', 'hover:bg-green-700');
            
            setTimeout(() => {
              btn.innerHTML = originalHTML;
              btn.className = originalClasses.join(' ');
            }, 2000);
          }).catch(err => {
            alert('Failed to copy. Please copy manually.');
          });
        }
      </script>
    <p class="text-xs text-gray-500 mt-2">In production, this will use your actual domain automatically.</p>
  </div>
  </form>
</div>